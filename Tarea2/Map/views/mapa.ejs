<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Mapa</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="/styles/style.css">
  </head>
  <body>
    <h1 class="display-1">La Mejor Ruta</h1>
    <div class="row">
      <div class="col-md-4 offset-md-1">
        <h2 class="display-4">Coordenadas</h2>
        <h3>Inicio:</h3>
        <input type="text" name="inicio" id="inicio" placeholder="Ingresa una Ciudad" class="form-control"><p>
        <h3>Fin:</h3>
        <input type="text" name="fin" id="fin" placeholder="Ingresa una Ciudad" class="form-control">
        <br>
        <button type="button" name="button" class="btn btn-primary" onclick="getRuta()">Calcula ruta</button>
      </div>
      <div class="col-md-5 offset-md-1">
        <h2 class="display-4">Mapa</h2>
        <div id="map"></div>
      </div>
    </div>

    <script>
      var map;
      var marcadores=[];
      var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      var labelIndex = 0;

      function setMapOnAll(map) {
        for (var i = 0; i < marcadores.length; i++) {
          marcadores[i].setMap(map);
        }
      }

      function addMarker(location) {
        var marker = new google.maps.Marker({
          position: location,
          label: labels[labelIndex++ % labels.length],
          map: map
        });
        marcadores.push(marker);
      }

      function clearMarkers() {
        setMapOnAll(null);
      }

      function deleteMarkers() {
        clearMarkers();
        marcadores = [];
      }

      function setMapOnAll(map) {
        for (var i = 0; i < marcadores.length; i++) {
          marcadores[i].setMap(map);
        }
      }

      function getCoord(lugar) {
        var geocoder = new google.maps.Geocoder();

        geocoder.geocode({'address':lugar}, function(res, status){
          if (status === 'OK') {
            addMarker(res[0].geometry.location)
          } else {
            alert('Geocode no pudo encontrar el lugar porque: ' + status);
          }
        });
      }

      function initMap() {
        var uluru = {lat: 19.432618, lng: -99.133210}; // Pin a CDMX (Centro)
        map = new google.maps.Map(document.getElementById('map'), {
          zoom:4,
          center: uluru
        });
      }

      function getRuta() {
        deleteMarkers();

        var inicio=document.getElementById('inicio').value;
        var fin=document.getElementById('fin').value;

        if (inicio!="" && fin!="") {
          getCoord(inicio);
          getCoord(fin);

          setMapOnAll(map);
        }else {
          alert('Ingresa una(s) ciudad(s)');
        }

      }

    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAUTdVrQwqN5zPTpU8__YRCF8gla-OxTBE&callback=initMap">
    </script>
  </body>
</html>
